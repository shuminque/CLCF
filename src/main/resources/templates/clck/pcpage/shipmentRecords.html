<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Records</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <style>
        body, html {
            height: 100%;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .container {
            margin-top: 20px;
        }
        table {
            width: 100%;
            margin-bottom: 20px;
        }
        .pagination {
            justify-content: center;
        }
    </style>
</head>
<body>
<section class="section">
    <div class="container">
        <div class="field">
            <div class="control">
                <input class="input" type="text" id="search" placeholder="搜索...">
            </div>
        </div>
        <table class="table is-striped is-fullwidth">
            <thead>
            <tr>
                <th>发票编号</th>
                <th>客户</th>
                <th>贸易方式</th>
                <th>到货点</th>
                <th>到港日期</th>
                <th>到达日期</th>
                <th>钢材等级</th>
                <th>尺寸</th>
                <th>重量</th>
                <th>钢厂</th>
                <th>炉号</th>
                <th>操作类型</th>
                <th>库位</th>
            </tr>
            </thead>
            <tbody id="recordsTableBody">
            </tbody>
        </table>
        <nav class="pagination" role="navigation" aria-label="pagination">
            <a class="pagination-previous" id="prevPage">上一页</a>
            <a class="pagination-next" id="nextPage">下一页</a>
            <ul class="pagination-list" id="paginationList">
            </ul>
        </nav>
    </div>
</section>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        let currentPage = 1;
        const recordsPerPage = 10;

        function fetchRecords(page = 1, query = '') {
            axios.get('/records')
                .then(response => {
                    const records = response.data;
                    const filteredRecords = records.filter(record =>
                        Object.values(record).some(value =>
                            value.toString().toLowerCase().includes(query.toLowerCase())
                        )
                    );
                    displayRecords(filteredRecords, page);
                    setupPagination(filteredRecords.length, page);
                })
                .catch(error => {
                    console.error('Error fetching records:', error);
                });
        }

        function displayRecords(records, page) {
            const startIndex = (page - 1) * recordsPerPage;
            const endIndex = startIndex + recordsPerPage;
            const recordsToDisplay = records.slice(startIndex, endIndex);

            const tableBody = document.getElementById('recordsTableBody');
            tableBody.innerHTML = '';

            recordsToDisplay.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
        <td>${record.invoiceNumber || ''}</td>
        <td>${record.customer || ''}</td>
        <td>${record.tradeMode || ''}</td>
        <td>${record.deliveryPoint || ''}</td>
        <td>${record.arrivalPortDate || ''}</td>
        <td>${record.arrivalDate || ''}</td>
        <td>${record.steelGrade || ''}</td>
        <td>${record.dimensions || ''}</td>
        <td>${record.weight || ''}</td>
        <td>${record.steelMill || ''}</td>
        <td>${record.furnaceNumber || ''}</td>
        <td>${record.operationType || ''}</td>
        <td>${record.placementArea || ''}</td>
    `;
                tableBody.appendChild(row);
            });

        }

        function setupPagination(totalRecords, page) {
            const totalPages = Math.ceil(totalRecords / recordsPerPage);

            const paginationList = document.getElementById('paginationList');
            paginationList.innerHTML = '';

            for (let i = 1; i <= totalPages; i++) {
                const pageItem = document.createElement('li');
                const pageLink = document.createElement('a');
                pageLink.className = 'pagination-link';
                if (i === page) pageLink.classList.add('is-current');
                pageLink.innerText = i;
                pageLink.addEventListener('click', () => fetchRecords(i));
                pageItem.appendChild(pageLink);
                paginationList.appendChild(pageItem);
            }

            document.getElementById('prevPage').disabled = page === 1;
            document.getElementById('nextPage').disabled = page === totalPages;

            document.getElementById('prevPage').addEventListener('click', () => {
                if (page > 1) fetchRecords(page - 1);
            });
            document.getElementById('nextPage').addEventListener('click', () => {
                if (page < totalPages) fetchRecords(page + 1);
            });
        }

        document.getElementById('search').addEventListener('input', (event) => {
            const query = event.target.value;
            fetchRecords(1, query);
        });

        fetchRecords();
    });
</script>
</body>
</html>
